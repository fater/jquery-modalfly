!function(a){var o={template_loaded:!1,object_name_loading:"module_modalfly_loading",object_name_form:"module_modalfly_form",jsa:"",url:"api/",lang_close:"Закрыть",lang_save:"Сохранить",animate:!0};a.modalfly=function(t,e){if("options"==t)a.extend(o,e);else if("show"==t)o.template_loaded||(o.template_loaded=!0,a("body").prepend('<div class="modal'+(1==o.animate?" fade":"")+'" id="'+o.object_name_form+'"><div data-object="modalfly_dialog" class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal">&times;</button><h4 class="modal-title"></h4></div><div class="modal-body"></div><div class="modal-footer"><button type="button" class="btn btn-default" data-dismiss="modal" data-object="module_modalfly_close_button" autofocus>'+o.lang_close+'</button><button type="button" class="btn btn-primary" data-object="modalfly_save" data-param="" autofocus>'+o.lang_save+"</button></div></div></div></div>")),"string"==typeof e?e={content:e}:e.title||(e.title=""),a("#"+o.object_name_form+" h4[class=modal-title]").html(e.title),a("#"+o.object_name_form+" div[class=modal-body]").html(e.content),e.button_close?a("#"+o.object_name_form+' button[data-object="module_modalfly_close_button"]').html("string"==typeof e.button_close?e.button_close:o.lang_close).show(0):a("#"+o.object_name_form+' button[data-object="module_modalfly_close_button"]').hide(0),e.size_wide?a("#"+o.object_name_form+' div[data-object="modalfly_dialog"]').addClass("modal-lg"):a("#"+o.object_name_form+' div[data-object="modalfly_dialog"]').hasClass("modal-lg")&&a("#"+o.object_name_form+' div[data-object="modalfly_dialog"]').removeClass("modal-lg"),e.size_small?a("#"+o.object_name_form+' div[data-object="modalfly_dialog"]').addClass("modal-sm"):a("#"+o.object_name_form+' div[data-object="modalfly_dialog"]').hasClass("modal-sm")&&a("#"+o.object_name_form+' div[data-object="modalfly_dialog"]').removeClass("modal-sm"),e.button_save||e.param?(a("#"+o.object_name_form+' div[class="modal-footer"]').show(0),e.button_color?a("#"+o.object_name_form+' [data-object="modalfly_save"]').removeClass("btn-primary").addClass(e.button_color):a("#"+o.object_name_form+' [data-object="modalfly_save"]').removeClass().addClass("btn btn-primary"),e.button_save?a("#"+o.object_name_form+' [data-object="modalfly_save"]').html("string"==typeof e.button_save?e.button_save:o.lang_save).show():a("#"+o.object_name_form+' [data-object="modalfly_save"]').hide(),e.param?("object"==typeof e.param&&(e.param=JSON.stringify(e.param)),a("#"+o.object_name_form+' [data-object="modalfly_save"]').attr("data-param",e.param)):a("#"+o.object_name_form+' [data-object="modalfly_save"]').attr("data-param","")):e.button_close?a("#"+o.object_name_form+'  [data-object="modalfly_save"]').hide(0):a("#"+o.object_name_form+' div[class="modal-footer"]').hide(0),a("#"+o.object_name_form).on("show.bs.modal",function(){a(this).find("[autofocus]:first").focus()}).on("shown.bs.modal",function(){a(this).find("[autofocus]:first").focus()}),a("#"+o.object_name_form).modal("show"),a.modalfly("check_actions","modal_load");else if("load"==t)a.modalfly("show_loading"),a.ajax({url:e.url?e.url:o.url,type:"POST",dataType:"json",data:e.param,success:function(t){a.modalfly("close_loading"),t.content&&a.modalfly("show",t),t.js&&a.globalEval(t.js),t.jsa&&(o.jsa=t.jsa),t.close&&a.modalfly("close")},complete:function(){a.modalfly("close_loading")}});else if("show_loading"==t)o.overflow_loading||(o.overflow_loading=!0,a("body").prepend('<div id="'+o.object_name_loading+'"></div>')),a("#"+o.object_name_loading).css({marginTop:"-10px"}).animate({opacity:"show",marginTop:0},"fast");else if("close_loading"==t)a("#"+o.object_name_loading).animate({opacity:"hide",marginTop:"-10px"},"fast");else if("check_actions"==t){a("#"+o.object_name_form+' [data-trigger="enter"]').on("keypress",function(o){13===o.which&&a('button[data-object="modalfly_save"]').click()});var l="";"modal_load"==e&&(l="#"+o.object_name_form+" "),a(l+'[data-module="modalfly"]').each(function(o,t){var e={};e.param={},a(this).is("[data-action]")&&(e.param.action=a(this).attr("data-action")),a(this).is("[data-param]")&&(e.param.param=a(this).attr("data-param")),a(this).is("[data-id]")&&(e.param.id=a(this).attr("data-id")),a(this).is("[data-url]")&&(e.url=a(this).attr("data-url")),a(this).on("click",function(){a.modalfly("load",e)})})}else"close"==t&&a("#"+o.object_name_form).modal("hide")},a(document).on("hidden.bs.modal","#"+o.object_name_form,function(){""!=o.jsa&&(a.globalEval(o.jsa),o.jsa="")})}(jQuery),$(window).load(function(){$.modalfly("check_actions"),$(document).on("click",'button[data-object="modalfly_save"]',function(){if($(this).is(":visible")){var a={param:{}};$(this).attr("data-param").length&&(a.param=$.parseJSON($(this).attr("data-param"))),$('div[class="modal-body"] [data-name]').each(function(o,t){"checkbox"==$(this).attr("type")&&!$(this).is(":checked")||"radio"==$(this).attr("type")&&!$(this).is(":checked")||(a.param[$(this).attr("data-name")]=$(this).val())}),a.param.url&&(a.url=a.param.url,delete a.param.url),$.modalfly("load",a)}})});